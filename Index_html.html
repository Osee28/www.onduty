<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>On duty - Employment Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Navigation -->
    <nav class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <h1 class="text-2xl font-bold text-indigo-600">On duty</h1>
                    </div>
                </div>
                <div id="nav-menu" class="hidden md:block" style="display: none;">
                    <div class="ml-10 flex items-baseline space-x-4">
                        <button onclick="showSection('jobs')" class="nav-btn text-gray-700 hover:text-indigo-600 px-3 py-2 rounded-md text-sm font-medium">Jobs</button>
                        <button id="post-job-nav" onclick="showSection('post-job')" class="nav-btn text-gray-700 hover:text-indigo-600 px-3 py-2 rounded-md text-sm font-medium" style="display: none;">Post a Job</button>
                        <button id="applications-nav" onclick="showSection('applications')" class="nav-btn text-gray-700 hover:text-indigo-600 px-3 py-2 rounded-md text-sm font-medium" style="display: none;">Applications</button>
                        <button onclick="showSection('profile')" class="nav-btn text-gray-700 hover:text-indigo-600 px-3 py-2 rounded-md text-sm font-medium">My Profile</button>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div id="auth-buttons">
                        <button onclick="showLoginModal()" class="text-gray-700 hover:text-indigo-600 px-4 py-2 rounded-lg text-sm font-medium">Login</button>
                        <button onclick="showRegisterModal()" class="bg-indigo-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-indigo-700 transition-colors">Sign Up</button>
                    </div>
                    <div id="user-menu" class="flex items-center space-x-4" style="display: none;">
                        <span id="user-welcome" class="text-gray-700 text-sm"></span>
                        <button onclick="logout()" class="text-gray-700 hover:text-red-600 px-4 py-2 rounded-lg text-sm font-medium">Logout</button>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section id="hero" class="gradient-bg text-white py-20">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <h1 class="text-5xl font-bold mb-6">Find Your Next Job</h1>
            <p class="text-xl mb-8 opacity-90">Connect with the best opportunities and top talent</p>
            <div id="hero-search" class="max-w-2xl mx-auto" style="display: none;">
                <div class="flex flex-col sm:flex-row gap-4">
                    <input type="text" id="job-search" placeholder="Job title, keywords..." class="flex-1 px-6 py-4 rounded-lg text-gray-900 text-lg">
                    <input type="text" id="location-search" placeholder="City, region..." class="flex-1 px-6 py-4 rounded-lg text-gray-900 text-lg">
                    <button onclick="searchJobs()" class="bg-yellow-400 text-gray-900 px-8 py-4 rounded-lg font-semibold hover:bg-yellow-300 transition-colors">Search</button>
                </div>
            </div>
            <div id="hero-cta" class="max-w-2xl mx-auto">
                <p class="text-lg mb-8">Create your account to access job opportunities</p>
                <div class="flex flex-col sm:flex-row gap-4 justify-center">
                    <button onclick="showRegisterModal('candidate')" class="bg-yellow-400 text-gray-900 px-8 py-4 rounded-lg font-semibold hover:bg-yellow-300 transition-colors">I'm looking for a job</button>
                    <button onclick="showRegisterModal('employer')" class="bg-white text-indigo-600 px-8 py-4 rounded-lg font-semibold hover:bg-gray-100 transition-colors">I'm hiring</button>
                </div>
            </div>
        </div>
    </section>

    <!-- Welcome Section for Non-Logged Users -->
    <section id="welcome-section" class="py-16">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-16">
                <h2 class="text-4xl font-bold text-gray-900 mb-6">Why choose On duty?</h2>
                <p class="text-xl text-gray-600 max-w-3xl mx-auto">The platform that connects talent with the best professional opportunities</p>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div class="text-center p-8 bg-white rounded-xl shadow-lg">
                    <div class="text-5xl mb-4">üéØ</div>
                    <h3 class="text-xl font-semibold text-gray-900 mb-4">For Candidates</h3>
                    <ul class="text-gray-600 space-y-2">
                        <li>‚Ä¢ Access to the best offers</li>
                        <li>‚Ä¢ One-click application</li>
                        <li>‚Ä¢ Track your applications</li>
                        <li>‚Ä¢ Professional profile</li>
                    </ul>
                </div>
                
                <div class="text-center p-8 bg-white rounded-xl shadow-lg">
                    <div class="text-5xl mb-4">üè¢</div>
                    <h3 class="text-xl font-semibold text-gray-900 mb-4">For Companies</h3>
                    <ul class="text-gray-600 space-y-2">
                        <li>‚Ä¢ Simple job posting</li>
                        <li>‚Ä¢ Application management</li>
                        <li>‚Ä¢ Direct candidate contact</li>
                        <li>‚Ä¢ Complete dashboard</li>
                    </ul>
                </div>
                
                <div class="text-center p-8 bg-white rounded-xl shadow-lg">
                    <div class="text-5xl mb-4">‚ö°</div>
                    <h3 class="text-xl font-semibold text-gray-900 mb-4">Efficient</h3>
                    <ul class="text-gray-600 space-y-2">
                        <li>‚Ä¢ Fast process</li>
                        <li>‚Ä¢ Intuitive interface</li>
                        <li>‚Ä¢ Real-time notifications</li>
                        <li>‚Ä¢ Dedicated support</li>
                    </ul>
                </div>
            </div>
            
            <div class="text-center mt-12">
                <p class="text-lg text-gray-600 mb-6">Join thousands of users who trust us</p>
                <button onclick="showRegisterModal()" class="bg-indigo-600 text-white px-8 py-4 rounded-lg font-semibold hover:bg-indigo-700 transition-colors text-lg">Get started now</button>
            </div>
        </div>
    </section>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
        
        <!-- Jobs Section -->
        <section id="jobs-section" class="section-content">
            <div class="flex justify-between items-center mb-8">
                <h2 class="text-3xl font-bold text-gray-900">Recent Job Offers</h2>
                <div class="flex space-x-4">
                    <select id="job-filter" class="px-4 py-2 border border-gray-300 rounded-lg">
                        <option value="">All sectors</option>
                        <option value="tech">Technology</option>
                        <option value="marketing">Marketing</option>
                        <option value="finance">Finance</option>
                        <option value="design">Design</option>
                    </select>
                </div>
            </div>
            
            <div id="jobs-container" class="grid gap-6">
                <!-- Job listings will be populated here -->
            </div>
        </section>

        <!-- Post Job Section -->
        <section id="post-job-section" class="section-content hidden">
            <div class="max-w-3xl mx-auto">
                <h2 class="text-3xl font-bold text-gray-900 mb-8">Post a Job Offer</h2>
                <div class="bg-white rounded-xl shadow-lg p-8">
                    <form id="job-form" class="space-y-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Job Title</label>
                                <input type="text" id="job-title" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Company</label>
                                <input type="text" id="company-name" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" required>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Location</label>
                                <input type="text" id="job-location" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Sector</label>
                                <select id="job-sector" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" required>
                                    <option value="">Select a sector</option>
                                    <option value="tech">Technology</option>
                                    <option value="marketing">Marketing</option>
                                    <option value="finance">Finance</option>
                                    <option value="design">Design</option>
                                </select>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Job Description</label>
                            <textarea id="job-description" rows="6" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" required></textarea>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Salary (optional)</label>
                                <input type="text" id="job-salary" placeholder="e.g. $45,000 - $55,000" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Contract Type</label>
                                <select id="job-type" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" required>
                                    <option value="">Select</option>
                                    <option value="Full-time">Full-time</option>
                                    <option value="Part-time">Part-time</option>
                                    <option value="Contract">Contract</option>
                                    <option value="Internship">Internship</option>
                                    <option value="Freelance">Freelance</option>
                                </select>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Contact Email *</label>
                            <input type="email" id="employer-email" placeholder="recruitment@company.com" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" required>
                            <p class="text-sm text-gray-500 mt-1">Applications will be sent to this address</p>
                        </div>
                        
                        <button type="submit" class="w-full bg-indigo-600 text-white py-4 rounded-lg font-semibold hover:bg-indigo-700 transition-colors">Publish Job</button>
                    </form>
                </div>
            </div>
        </section>

        <!-- Applications Section -->
        <section id="applications-section" class="section-content hidden">
            <div class="max-w-6xl mx-auto">
                <h2 class="text-3xl font-bold text-gray-900 mb-8">Received Applications</h2>
                
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-semibold text-gray-900">Employer Dashboard</h3>
                        <div class="flex space-x-4">
                            <select id="application-filter" class="px-4 py-2 border border-gray-300 rounded-lg">
                                <option value="">All applications</option>
                                <option value="new">New</option>
                                <option value="reviewed">Reviewed</option>
                                <option value="contacted">Contacted</option>
                            </select>
                        </div>
                    </div>
                    
                    <div id="applications-container" class="space-y-4">
                        <!-- Applications will be populated here -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Profile Section -->
        <section id="profile-section" class="section-content hidden">
            <div class="max-w-4xl mx-auto">
                <h2 class="text-3xl font-bold text-gray-900 mb-8">My Profile</h2>
                <div id="profile-content" class="bg-white rounded-xl shadow-lg p-8">
                    <!-- Profile content will be populated dynamically -->
                </div>
            </div>
        </section>
    </div>

    <script>
        // User authentication system
        let currentUser = null;
        let isLoggedIn = false;

        // Authentication functions
        function showLoginModal() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-white rounded-xl shadow-2xl max-w-md w-full">
                    <div class="p-6 border-b">
                        <div class="flex justify-between items-center">
                            <h3 class="text-2xl font-bold text-gray-900">Login</h3>
                            <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
                        </div>
                    </div>
                    
                    <form id="login-form" class="p-6 space-y-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                            <input type="email" id="login-email" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" required>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                            <input type="password" id="login-password" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" required>
                        </div>
                        
                        <div class="flex space-x-4 pt-4">
                            <button type="button" onclick="closeModal()" class="flex-1 px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">Cancel</button>
                            <button type="submit" class="flex-1 px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors">Login</button>
                        </div>
                        
                        <div class="text-center space-y-2">
                            <p class="text-sm text-gray-600">
                                <button type="button" onclick="closeModal(); showForgotPasswordModal();" class="text-indigo-600 hover:underline">Forgot password?</button>
                            </p>
                            <p class="text-sm text-gray-600">Don't have an account? 
                                <button type="button" onclick="closeModal(); showRegisterModal();" class="text-indigo-600 hover:underline">Sign up</button>
                            </p>
                        </div>
                    </form>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            document.getElementById('login-form').addEventListener('submit', function(e) {
                e.preventDefault();
                handleLogin();
            });
        }

        function showRegisterModal(userType = null) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-white rounded-xl shadow-2xl max-w-md w-full">
                    <div class="p-6 border-b">
                        <div class="flex justify-between items-center">
                            <h3 class="text-2xl font-bold text-gray-900">Create Account</h3>
                            <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
                        </div>
                    </div>
                    
                    <form id="register-form" class="p-6 space-y-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Account Type</label>
                            <select id="account-type" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" required>
                                <option value="">Select</option>
                                <option value="candidate" ${userType === 'candidate' ? 'selected' : ''}>Candidate - I'm looking for a job</option>
                                <option value="employer" ${userType === 'employer' ? 'selected' : ''}>Employer - I'm hiring</option>
                            </select>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">First Name</label>
                                <input type="text" id="register-firstname" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Last Name</label>
                                <input type="text" id="register-lastname" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" required>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                            <input type="email" id="register-email" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" required>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Country of residence *</label>
                            <select id="register-country" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" required>
                                <option value="">Select your country</option>
                                <option value="US">United States</option>
                                <option value="CA">Canada</option>
                                <option value="GB">United Kingdom</option>
                                <option value="FR">France</option>
                                <option value="DE">Germany</option>
                                <option value="ES">Spain</option>
                                <option value="IT">Italy</option>
                                <option value="NL">Netherlands</option>
                                <option value="BE">Belgium</option>
                                <option value="CH">Switzerland</option>
                                <option value="AU">Australia</option>
                                <option value="NZ">New Zealand</option>
                                <option value="OTHER">üåç Other country</option>
                            </select>
                        </div>
                        
                        <div id="company-field" style="display: none;">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Company Name</label>
                            <input type="text" id="register-company" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                        </div>
                        
                        <div id="company-description-field" style="display: none;">
                            <label class="block text-sm font-medium text-gray-700 mb-2">About your company</label>
                            <textarea id="register-company-description" rows="4" placeholder="Describe your company, industry, values, company culture..." class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"></textarea>
                            <p class="text-sm text-gray-500 mt-1">This description will appear on your employer profile and help candidates learn about your company</p>
                        </div>
                        
                        <div id="candidate-bio-field" style="display: none;">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Tell us about yourself</label>
                            <textarea id="register-candidate-bio" rows="4" placeholder="Describe your background, career goals, what motivates you, key experiences..." class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"></textarea>
                            <p class="text-sm text-gray-500 mt-1">This description will appear on your candidate profile and help employers get to know you</p>
                        </div>
                        
                        <div id="candidate-skills-field" style="display: none;">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Your main skills</label>
                            <input type="text" id="register-candidate-skills" placeholder="Ex: JavaScript, React, Digital Marketing, Project Management, Photoshop, Communication..." class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                            <p class="text-sm text-gray-500 mt-1">Separate your skills with commas. These skills will appear as badges on your profile</p>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                            <input type="password" id="register-password" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" required>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Confirm Password</label>
                            <input type="password" id="register-confirm-password" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" required>
                        </div>
                        
                        <div class="flex items-start">
                            <input type="checkbox" id="terms-consent" class="mt-1 mr-3" required>
                            <label for="terms-consent" class="text-sm text-gray-700">
                                I accept the terms of use and privacy policy
                            </label>
                        </div>
                        
                        <div class="flex space-x-4 pt-4">
                            <button type="button" onclick="closeModal()" class="flex-1 px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">Cancel</button>
                            <button type="submit" class="flex-1 px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors">Create Account</button>
                        </div>
                        
                        <div class="text-center">
                            <p class="text-sm text-gray-600">Already have an account? 
                                <button type="button" onclick="closeModal(); showLoginModal();" class="text-indigo-600 hover:underline">Login</button>
                            </p>
                        </div>
                    </form>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Show/hide fields based on account type
            document.getElementById('account-type').addEventListener('change', function() {
                const companyField = document.getElementById('company-field');
                const companyInput = document.getElementById('register-company');
                const companyDescField = document.getElementById('company-description-field');
                const candidateBioField = document.getElementById('candidate-bio-field');
                const candidateSkillsField = document.getElementById('candidate-skills-field');
                
                if (this.value === 'employer') {
                    // Show employer fields
                    companyField.style.display = 'block';
                    companyDescField.style.display = 'block';
                    companyInput.required = true;
                    
                    // Hide candidate fields
                    candidateBioField.style.display = 'none';
                    candidateSkillsField.style.display = 'none';
                } else if (this.value === 'candidate') {
                    // Show candidate fields
                    candidateBioField.style.display = 'block';
                    candidateSkillsField.style.display = 'block';
                    
                    // Hide employer fields
                    companyField.style.display = 'none';
                    companyDescField.style.display = 'none';
                    companyInput.required = false;
                } else {
                    // Hide all specific fields
                    companyField.style.display = 'none';
                    companyDescField.style.display = 'none';
                    candidateBioField.style.display = 'none';
                    candidateSkillsField.style.display = 'none';
                    companyInput.required = false;
                }
            });
            
            // Trigger change event if userType is pre-selected
            if (userType) {
                document.getElementById('account-type').dispatchEvent(new Event('change'));
            }
            
            document.getElementById('register-form').addEventListener('submit', function(e) {
                e.preventDefault();
                handleRegister();
            });
        }

        function handleLogin() {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            
            // Simulate login (in real app, this would be an API call)
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const user = users.find(u => u.email === email && u.password === password);
            
            if (user) {
                currentUser = user;
                isLoggedIn = true;
                localStorage.setItem('currentUser', JSON.stringify(user));
                
                closeModal();
                updateUIForLoggedInUser();
                alert(`Login successful! Welcome ${user.firstName} ${user.lastName}`);
            } else {
                alert('Incorrect email or password');
            }
        }

        function handleRegister() {
            const accountType = document.getElementById('account-type').value;
            const firstName = document.getElementById('register-firstname').value;
            const lastName = document.getElementById('register-lastname').value;
            const email = document.getElementById('register-email').value;
            const country = document.getElementById('register-country').value;
            const company = document.getElementById('register-company').value;
            const companyDescription = document.getElementById('register-company-description').value;
            const candidateBio = document.getElementById('register-candidate-bio').value;
            const candidateSkills = document.getElementById('register-candidate-skills').value;
            const password = document.getElementById('register-password').value;
            const confirmPassword = document.getElementById('register-confirm-password').value;
            
            // Validation
            if (!accountType) {
                alert('Please select an account type');
                return;
            }
            
            if (!firstName || !lastName || !email || !country || !password || !confirmPassword) {
                alert('Please fill in all required fields');
                return;
            }
            
            if (accountType === 'employer' && !company) {
                alert('Please enter your company name');
                return;
            }
            
            if (password !== confirmPassword) {
                alert('Passwords do not match');
                return;
            }
            
            if (password.length < 6) {
                alert('Password must be at least 6 characters long');
                return;
            }
            
            // Check if user already exists
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            if (users.find(u => u.email === email)) {
                alert('An account with this email already exists');
                return;
            }
            
            // Get country name from code
            const countryNames = {
                'US': 'United States', 'CA': 'Canada', 'GB': 'United Kingdom', 'FR': 'France',
                'DE': 'Germany', 'ES': 'Spain', 'IT': 'Italy', 'NL': 'Netherlands',
                'BE': 'Belgium', 'CH': 'Switzerland', 'AU': 'Australia', 'NZ': 'New Zealand',
                'OTHER': 'Other country'
            };
            
            // Process skills for candidates
            let processedSkills = [];
            if (accountType === 'candidate' && candidateSkills) {
                processedSkills = candidateSkills.split(',').map(skill => skill.trim()).filter(skill => skill.length > 0);
            } else if (accountType === 'candidate') {
                processedSkills = ['Communication', 'Teamwork', 'Adaptability', 'Problem Solving']; // Default skills
            }
            
            // Create new user
            const newUser = {
                id: Date.now(),
                accountType,
                firstName,
                lastName,
                email,
                country,
                countryName: countryNames[country] || country,
                company: accountType === 'employer' ? company : null,
                companyDescription: accountType === 'employer' ? (companyDescription || null) : null,
                password,
                skills: processedSkills,
                location: countryNames[country] || country,
                bio: accountType === 'candidate' ? 
                    (candidateBio || `Motivated professional with strong adaptability and excellent teamwork skills. Always looking for new challenges and opportunities for professional growth.`) :
                    (companyDescription || `Dynamic and innovative company, we are looking for the best talent to join our team and contribute to our growth.`),
                createdAt: new Date().toISOString()
            };
            
            users.push(newUser);
            localStorage.setItem('users', JSON.stringify(users));
            
            // Auto login
            currentUser = newUser;
            isLoggedIn = true;
            localStorage.setItem('currentUser', JSON.stringify(newUser));
            
            closeModal();
            updateUIForLoggedInUser();
            
            // Show personalized success message
            let successMessage = `üéâ Account created successfully!\n\nWelcome ${firstName} ${lastName}!\n\n`;
            
            if (accountType === 'candidate') {
                successMessage += `‚úÖ Candidate profile configured:\n`;
                successMessage += `‚Ä¢ Description: ${candidateBio ? 'Customized' : 'Default'}\n`;
                successMessage += `‚Ä¢ Skills: ${processedSkills.length} skill(s) added\n`;
                successMessage += `‚Ä¢ Country: ${countryNames[country]}\n\n`;
                successMessage += `You can now:\n`;
                successMessage += `‚Ä¢ Browse job offers\n`;
                successMessage += `‚Ä¢ Apply to jobs that interest you\n`;
                successMessage += `‚Ä¢ Manage your profile and applications`;
            } else {
                successMessage += `‚úÖ Employer profile configured:\n`;
                successMessage += `‚Ä¢ Company: ${company}\n`;
                successMessage += `‚Ä¢ Description: ${companyDescription ? 'Customized' : 'Default'}\n`;
                successMessage += `‚Ä¢ Country: ${countryNames[country]}\n\n`;
                successMessage += `You can now:\n`;
                successMessage += `‚Ä¢ Post job offers\n`;
                successMessage += `‚Ä¢ Manage received applications\n`;
                successMessage += `‚Ä¢ Contact candidates directly`;
            }
            
            alert(successMessage);
        }

        function updateUIForLoggedInUser() {
            console.log('Updating UI for logged in user:', currentUser);
            
            // Hide auth buttons, show user menu
            document.getElementById('auth-buttons').style.display = 'none';
            document.getElementById('user-menu').style.display = 'flex';
            document.getElementById('user-welcome').textContent = `Hello ${currentUser.firstName}`;
            
            // Show navigation menu
            document.getElementById('nav-menu').style.display = 'block';
            
            // Show/hide sections based on user type
            if (currentUser.accountType === 'employer') {
                document.getElementById('post-job-nav').style.display = 'block';
                document.getElementById('applications-nav').style.display = 'block';
                
                // Pre-fill employer email in job posting form
                setTimeout(() => {
                    const employerEmailField = document.getElementById('employer-email');
                    if (employerEmailField) {
                        employerEmailField.value = currentUser.email;
                        employerEmailField.readOnly = true;
                        employerEmailField.style.backgroundColor = '#f9fafb';
                    }
                }, 100);
            } else {
                document.getElementById('post-job-nav').style.display = 'none';
                document.getElementById('applications-nav').style.display = 'none';
            }
            
            // Update hero section
            document.getElementById('hero-cta').style.display = 'none';
            document.getElementById('hero-search').style.display = 'block';
            
            // Hide welcome section, show jobs
            document.getElementById('welcome-section').style.display = 'none';
            showSection('jobs');
            
            // Refresh job display to show correct buttons
            displayJobs(allJobs);
        }

        function logout() {
            currentUser = null;
            isLoggedIn = false;
            localStorage.removeItem('currentUser');
            
            // Reset UI
            document.getElementById('auth-buttons').style.display = 'flex';
            document.getElementById('user-menu').style.display = 'none';
            document.getElementById('nav-menu').style.display = 'none';
            
            // Reset hero section
            document.getElementById('hero-cta').style.display = 'block';
            document.getElementById('hero-search').style.display = 'none';
            
            // Show welcome section
            document.getElementById('welcome-section').style.display = 'block';
            
            // Hide all content sections
            document.querySelectorAll('.section-content').forEach(section => {
                section.classList.add('hidden');
            });
            
            alert('Logout successful');
        }

        function showForgotPasswordModal() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-white rounded-xl shadow-2xl max-w-md w-full">
                    <div class="p-6 border-b">
                        <div class="flex justify-between items-center">
                            <h3 class="text-2xl font-bold text-gray-900">Password Recovery</h3>
                            <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
                        </div>
                    </div>
                    
                    <div id="forgot-password-step1" class="p-6">
                        <p class="text-gray-600 mb-6">Enter your email address to receive password recovery instructions.</p>
                        
                        <form id="forgot-password-form" class="space-y-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Email address</label>
                                <input type="email" id="forgot-email" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" required>
                            </div>
                            
                            <div class="flex space-x-4 pt-4">
                                <button type="button" onclick="closeModal()" class="flex-1 px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">Cancel</button>
                                <button type="submit" class="flex-1 px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors">Send</button>
                            </div>
                        </form>
                        
                        <div class="text-center mt-4">
                            <p class="text-sm text-gray-600">Remember your password? 
                                <button type="button" onclick="closeModal(); showLoginModal();" class="text-indigo-600 hover:underline">Login</button>
                            </p>
                        </div>
                    </div>
                    
                    <div id="forgot-password-step2" class="p-6 hidden">
                        <div class="text-center">
                            <div class="text-6xl mb-4">üìß</div>
                            <h4 class="text-xl font-semibold text-gray-900 mb-4">Email sent!</h4>
                            <p class="text-gray-600 mb-6">We've sent a verification code to your email address. Enter the code below to reset your password.</p>
                        </div>
                        
                        <form id="verify-code-form" class="space-y-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Verification code</label>
                                <input type="text" id="verification-code" placeholder="Enter 6-digit code" maxlength="6" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-center text-2xl tracking-widest" required>
                                <p class="text-sm text-gray-500 mt-1">Code sent to <span id="sent-email" class="font-medium"></span></p>
                            </div>
                            
                            <div class="flex space-x-4 pt-4">
                                <button type="button" onclick="goBackToEmailStep()" class="flex-1 px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">Back</button>
                                <button type="submit" class="flex-1 px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors">Verify</button>
                            </div>
                        </form>
                        
                        <div class="text-center mt-4">
                            <button type="button" onclick="resendVerificationCode()" class="text-sm text-indigo-600 hover:underline">Resend code</button>
                        </div>
                    </div>
                    
                    <div id="forgot-password-step3" class="p-6 hidden">
                        <div class="text-center mb-6">
                            <div class="text-6xl mb-4">üîí</div>
                            <h4 class="text-xl font-semibold text-gray-900 mb-2">New password</h4>
                            <p class="text-gray-600">Choose a new secure password for your account.</p>
                        </div>
                        
                        <form id="reset-password-form" class="space-y-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">New password</label>
                                <input type="password" id="new-password" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" required>
                                <p class="text-sm text-gray-500 mt-1">Minimum 6 characters</p>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Confirm password</label>
                                <input type="password" id="confirm-new-password" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" required>
                            </div>
                            
                            <div class="flex space-x-4 pt-4">
                                <button type="button" onclick="closeModal()" class="flex-1 px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">Cancel</button>
                                <button type="submit" class="flex-1 px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors">Reset</button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Handle forgot password form
            document.getElementById('forgot-password-form').addEventListener('submit', function(e) {
                e.preventDefault();
                handleForgotPassword();
            });
            
            // Handle verification code form
            document.getElementById('verify-code-form').addEventListener('submit', function(e) {
                e.preventDefault();
                handleVerificationCode();
            });
            
            // Handle reset password form
            document.getElementById('reset-password-form').addEventListener('submit', function(e) {
                e.preventDefault();
                handlePasswordReset();
            });
        }
        
        let forgotPasswordData = {};
        
        function handleForgotPassword() {
            const email = document.getElementById('forgot-email').value;
            
            // Check if user exists
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const user = users.find(u => u.email === email);
            
            if (!user) {
                alert('No account found with this email address.');
                return;
            }
            
            // Generate verification code
            const verificationCode = Math.floor(100000 + Math.random() * 900000).toString();
            
            // Store data for verification
            forgotPasswordData = {
                email: email,
                userId: user.id,
                verificationCode: verificationCode,
                timestamp: Date.now()
            };
            
            // Send email using EmailJS or similar service
            sendVerificationEmail(email, verificationCode, user.firstName)
                .then(() => {
                    // Show step 2 only after email is sent
                    document.getElementById('forgot-password-step1').classList.add('hidden');
                    document.getElementById('forgot-password-step2').classList.remove('hidden');
                    document.getElementById('sent-email').textContent = email;
                    
                    alert(`üìß Email sent successfully!\n\nA verification code has been sent to ${email}.\n\nCheck your inbox (and spam folder) to receive the 6-digit code.`);
                })
                .catch((error) => {
                    console.error('Email sending error:', error);
                    alert(`‚ùå Error sending email.\n\nUnable to send verification code to ${email}.\n\nPlease check your email address and try again.\n\nTechnical error: Email service temporarily unavailable.`);
                });
        }
        
        // Function to send verification email
        async function sendVerificationEmail(email, code, firstName) {
            // IMPORTANT: In a real application, this would be done server-side
            // Here we simulate email sending as browsers cannot send emails directly
            
            try {
                // Simulation of an email service (like EmailJS, SendGrid, etc.)
                const emailData = {
                    to: email,
                    subject: 'JobConnect - Password Recovery Code',
                    html: `
                        <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px;">
                            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 30px; text-align: center; border-radius: 10px 10px 0 0;">
                                <h1 style="color: white; margin: 0; font-size: 28px;">JobConnect</h1>
                                <p style="color: white; margin: 10px 0 0 0; opacity: 0.9;">Password Recovery</p>
                            </div>
                            
                            <div style="background: white; padding: 30px; border: 1px solid #e5e7eb; border-radius: 0 0 10px 10px;">
                                <h2 style="color: #1f2937; margin-bottom: 20px;">Hello ${firstName},</h2>
                                
                                <p style="color: #4b5563; line-height: 1.6; margin-bottom: 25px;">
                                    You requested to reset your JobConnect password. 
                                    Use the verification code below to continue:
                                </p>
                                
                                <div style="background: #f3f4f6; padding: 25px; border-radius: 8px; text-align: center; margin: 25px 0;">
                                    <p style="color: #6b7280; margin: 0 0 10px 0; font-size: 14px;">Verification code:</p>
                                    <div style="font-size: 32px; font-weight: bold; color: #4f46e5; letter-spacing: 8px; font-family: monospace;">
                                        ${code}
                                    </div>
                                    <p style="color: #ef4444; margin: 15px 0 0 0; font-size: 12px;">
                                        ‚è∞ This code expires in 10 minutes
                                    </p>
                                </div>
                                
                                <div style="background: #fef3c7; border: 1px solid #f59e0b; padding: 15px; border-radius: 6px; margin: 20px 0;">
                                    <p style="color: #92400e; margin: 0; font-size: 14px;">
                                        <strong>üîí Security:</strong> If you didn't request this reset, 
                                        ignore this email. Your password will remain unchanged.
                                    </p>
                                </div>
                                
                                <p style="color: #4b5563; line-height: 1.6; margin-top: 25px;">
                                    If you have questions, contact our support at 
                                    <a href="mailto:support@jobconnect.com" style="color: #4f46e5;">support@jobconnect.com</a>
                                </p>
                                
                                <hr style="border: none; border-top: 1px solid #e5e7eb; margin: 25px 0;">
                                
                                <p style="color: #9ca3af; font-size: 12px; text-align: center; margin: 0;">
                                    ¬© 2024 JobConnect - Employment Platform<br>
                                    This email was sent automatically, please do not reply.
                                </p>
                            </div>
                        </div>
                    `
                };
                
                // Simulation of sending (in a real app, use a service like EmailJS)
                console.log('üìß Simulated email sent to:', email);
                console.log('üìß Content:', emailData);
                
                // Simulation of sending delay
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // In a real application, you would use something like:
                // await emailjs.send('service_id', 'template_id', emailData);
                // or
                // await fetch('/api/send-email', { method: 'POST', body: JSON.stringify(emailData) });
                
                return Promise.resolve();
                
            } catch (error) {
                console.error('Email simulation error:', error);
                return Promise.reject(error);
            }
        }
        
        function handleVerificationCode() {
            const enteredCode = document.getElementById('verification-code').value;
            
            if (!forgotPasswordData.verificationCode) {
                alert('Error: No verification code generated.');
                return;
            }
            
            // Check if code is correct
            if (enteredCode !== forgotPasswordData.verificationCode) {
                alert('Incorrect verification code. Please try again.');
                return;
            }
            
            // Check if code is not expired (10 minutes)
            const currentTime = Date.now();
            const codeAge = currentTime - forgotPasswordData.timestamp;
            if (codeAge > 10 * 60 * 1000) { // 10 minutes
                alert('The verification code has expired. Please start over.');
                return;
            }
            
            // Show step 3
            document.getElementById('forgot-password-step2').classList.add('hidden');
            document.getElementById('forgot-password-step3').classList.remove('hidden');
        }
        
        function handlePasswordReset() {
            const newPassword = document.getElementById('new-password').value;
            const confirmPassword = document.getElementById('confirm-new-password').value;
            
            if (newPassword.length < 6) {
                alert('Password must be at least 6 characters long.');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                alert('Passwords do not match.');
                return;
            }
            
            // Update user password
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const userIndex = users.findIndex(u => u.id === forgotPasswordData.userId);
            
            if (userIndex > -1) {
                users[userIndex].password = newPassword;
                localStorage.setItem('users', JSON.stringify(users));
                
                // Clear forgot password data
                forgotPasswordData = {};
                
                closeModal();
                alert('‚úÖ Password reset successfully!\n\nYou can now login with your new password.');
                
                // Show login modal
                setTimeout(() => {
                    showLoginModal();
                }, 500);
            } else {
                alert('Error: User not found.');
            }
        }
        
        function goBackToEmailStep() {
            document.getElementById('forgot-password-step2').classList.add('hidden');
            document.getElementById('forgot-password-step1').classList.remove('hidden');
            document.getElementById('verification-code').value = '';
        }
        
        function resendVerificationCode() {
            if (!forgotPasswordData.email) {
                alert('Error: No email address found.');
                return;
            }
            
            // Generate new verification code
            const verificationCode = Math.floor(100000 + Math.random() * 900000).toString();
            forgotPasswordData.verificationCode = verificationCode;
            forgotPasswordData.timestamp = Date.now();
            
            // Clear input
            document.getElementById('verification-code').value = '';
            
            // Get user info for email
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const user = users.find(u => u.email === forgotPasswordData.email);
            
            // Send new verification email
            sendVerificationEmail(forgotPasswordData.email, verificationCode, user ? user.firstName : 'User')
                .then(() => {
                    alert(`üìß New code sent successfully!\n\nA new verification code has been sent to ${forgotPasswordData.email}.\n\nCheck your inbox (and spam folder).`);
                })
                .catch((error) => {
                    console.error('Email resend error:', error);
                    alert(`‚ùå Error resending email.\n\nUnable to send new code to ${forgotPasswordData.email}.\n\nPlease try again in a few moments.`);
                });
        }

        function checkAuthOnLoad() {
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                isLoggedIn = true;
                updateUIForLoggedInUser();
            }
        }

        // Sample job data
        const sampleJobs = [
            {
                id: 1,
                title: "Frontend React Developer",
                company: "TechCorp",
                location: "New York",
                sector: "tech",
                type: "Full-time",
                salary: "$65,000 - $75,000",
                description: "We are looking for an experienced Frontend React developer to join our dynamic team.",
                posted: "2 days ago",
                employerEmail: "recruitment@techcorp.com"
            },
            {
                id: 2,
                title: "Marketing Project Manager",
                company: "MarketPro",
                location: "Los Angeles",
                sector: "marketing",
                type: "Full-time",
                salary: "$55,000 - $65,000",
                description: "Marketing project manager position to manage our digital campaigns and coordinate teams.",
                posted: "1 day ago",
                employerEmail: "hr@marketpro.com"
            },
            {
                id: 3,
                title: "Financial Analyst",
                company: "FinanceExpert",
                location: "Chicago",
                sector: "finance",
                type: "Contract",
                salary: "$50,000 - $60,000",
                description: "Financial analyst to support our clients in their investment decisions.",
                posted: "3 days ago",
                employerEmail: "jobs@financeexpert.com"
            },
            {
                id: 4,
                title: "UX/UI Designer",
                company: "CreativeStudio",
                location: "San Francisco",
                sector: "design",
                type: "Freelance",
                salary: "$500 - $800/day",
                description: "UX/UI Designer to create exceptional user experiences for our clients.",
                posted: "1 day ago",
                employerEmail: "contact@creativestudio.com"
            }
        ];

        let allJobs = [...sampleJobs];

        // Navigation functions
        function showSection(sectionName) {
            // Check if user is logged in
            if (!isLoggedIn) {
                alert('You must be logged in to access this section');
                showLoginModal();
                return;
            }
            
            // Check permissions for employer-only sections
            if ((sectionName === 'post-job' || sectionName === 'applications') && currentUser.accountType !== 'employer') {
                alert('This section is reserved for employers');
                return;
            }
            
            // Hide all sections
            document.querySelectorAll('.section-content').forEach(section => {
                section.classList.add('hidden');
            });
            
            // Show selected section
            if (sectionName === 'jobs') {
                document.getElementById('jobs-section').classList.remove('hidden');
                document.getElementById('hero').style.display = 'block';
            } else {
                document.getElementById('hero').style.display = 'none';
                if (sectionName === 'post-job') {
                    document.getElementById('post-job-section').classList.remove('hidden');
                } else if (sectionName === 'applications') {
                    document.getElementById('applications-section').classList.remove('hidden');
                    displayApplications();
                } else if (sectionName === 'profile') {
                    document.getElementById('profile-section').classList.remove('hidden');
                    displayUserProfile();
                }
            }
            
            // Update nav buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('text-indigo-600', 'font-semibold');
                btn.classList.add('text-gray-700');
            });
            if (event && event.target) {
                event.target.classList.remove('text-gray-700');
                event.target.classList.add('text-indigo-600', 'font-semibold');
            }
        }

        function displayUserProfile() {
            const profileContainer = document.getElementById('profile-content');
            
            if (!currentUser) {
                profileContainer.innerHTML = '<p class="text-center text-gray-500">Error: User not logged in</p>';
                return;
            }
            
            // Get user applications
            const userApplications = JSON.parse(localStorage.getItem('userApplications') || '[]');
            const userApps = userApplications.filter(app => app.email === currentUser.email);
            
            if (currentUser.accountType === 'candidate') {
                profileContainer.innerHTML = `
                    <div class="flex items-center space-x-6 mb-8">
                        <div class="relative">
                            <div class="w-24 h-24 rounded-full overflow-hidden bg-indigo-100 flex items-center justify-center">
                                ${currentUser.profilePhoto ? 
                                    `<img src="${currentUser.profilePhoto}" alt="Profile photo" class="w-full h-full object-cover">` :
                                    `<span class="text-3xl font-bold text-indigo-600">${currentUser.firstName.charAt(0)}${currentUser.lastName.charAt(0)}</span>`
                                }
                            </div>
                            <button onclick="showPhotoModal()" class="absolute -bottom-1 -right-1 bg-indigo-600 text-white rounded-full w-8 h-8 flex items-center justify-center hover:bg-indigo-700 transition-colors text-sm">
                                üì∑
                            </button>
                        </div>
                        <div>
                            <h3 class="text-2xl font-bold text-gray-900">${currentUser.firstName} ${currentUser.lastName}</h3>
                            <p class="text-gray-600">${currentUser.accountType === 'candidate' ? 'Candidate' : 'Employer'}</p>
                            <p class="text-gray-500">üìç ${currentUser.countryName || currentUser.location || 'United States'}</p>
                            <p class="text-gray-500">‚úâÔ∏è ${currentUser.email}</p>
                        </div>
                    </div>
                    
                    <div class="mb-8">
                        <h4 class="text-lg font-semibold text-gray-900 mb-4">About</h4>
                        <p class="text-gray-700">${currentUser.bio || 'No description available'}</p>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div>
                            <h4 class="text-lg font-semibold text-gray-900 mb-4">Skills</h4>
                            <div class="flex flex-wrap gap-2">
                                ${(currentUser.skills || []).map(skill => 
                                    `<span class="px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm">${skill}</span>`
                                ).join('')}
                            </div>
                        </div>
                        
                        <div>
                            <h4 class="text-lg font-semibold text-gray-900 mb-4">My Applications (${userApps.length})</h4>
                            <div class="space-y-3 max-h-64 overflow-y-auto">
                                ${userApps.length > 0 ? userApps.map(app => `
                                    <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                                        <div>
                                            <span class="font-medium">${app.jobTitle}</span>
                                            <p class="text-sm text-gray-600">${app.company}</p>
                                            <p class="text-xs text-gray-500">${app.date}</p>
                                        </div>
                                        <span class="text-sm px-2 py-1 rounded-full ${
                                            app.status === 'Sent' ? 'bg-blue-100 text-blue-600' :
                                            app.status === 'In Progress' ? 'bg-yellow-100 text-yellow-600' :
                                            'bg-green-100 text-green-600'
                                        }">${app.status}</span>
                                    </div>
                                `).join('') : '<p class="text-gray-500 text-sm">No applications sent</p>'}
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-8 pt-6 border-t">
                        <div class="flex justify-between items-center mb-4">
                            <h4 class="text-lg font-semibold text-gray-900">Account Information</h4>
                            <button onclick="showEditProfileModal()" class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition-colors text-sm">
                                ‚úèÔ∏è Edit Profile
                            </button>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                            <div>
                                <span class="text-gray-600">Account type:</span>
                                <span class="ml-2 font-medium">Candidate</span>
                            </div>
                            <div>
                                <span class="text-gray-600">Member since:</span>
                                <span class="ml-2 font-medium">${new Date(currentUser.createdAt).toLocaleDateString('en-US')}</span>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                // Employer profile
                const employerJobs = allJobs.filter(job => job.employerEmail === currentUser.email);
                const employerApplications = allApplications.filter(app => app.employerEmail === currentUser.email);
                
                profileContainer.innerHTML = `
                    <div class="flex items-center space-x-6 mb-8">
                        <div class="relative">
                            <div class="w-24 h-24 rounded-full overflow-hidden bg-indigo-100 flex items-center justify-center">
                                ${currentUser.profilePhoto ? 
                                    `<img src="${currentUser.profilePhoto}" alt="Profile photo" class="w-full h-full object-cover">` :
                                    `<span class="text-3xl font-bold text-indigo-600">${currentUser.firstName.charAt(0)}${currentUser.lastName.charAt(0)}</span>`
                                }
                            </div>
                            <button onclick="showPhotoModal()" class="absolute -bottom-1 -right-1 bg-indigo-600 text-white rounded-full w-8 h-8 flex items-center justify-center hover:bg-indigo-700 transition-colors text-sm">
                                üì∑
                            </button>
                        </div>
                        <div>
                            <h3 class="text-2xl font-bold text-gray-900">${currentUser.firstName} ${currentUser.lastName}</h3>
                            <p class="text-gray-600">Employer - ${currentUser.company}</p>
                            <p class="text-gray-500">üìç ${currentUser.countryName || currentUser.location || 'United States'}</p>
                            <p class="text-gray-500">‚úâÔ∏è ${currentUser.email}</p>
                        </div>
                    </div>
                    
                    <div class="mb-8">
                        <h4 class="text-lg font-semibold text-gray-900 mb-4">About the company</h4>
                        <p class="text-gray-700">${currentUser.bio || 'No description available'}</p>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                        <div class="bg-blue-50 p-6 rounded-lg text-center">
                            <div class="text-3xl font-bold text-blue-600">${employerJobs.length}</div>
                            <div class="text-blue-800 font-medium">Published jobs</div>
                        </div>
                        <div class="bg-green-50 p-6 rounded-lg text-center">
                            <div class="text-3xl font-bold text-green-600">${employerApplications.length}</div>
                            <div class="text-green-800 font-medium">Applications received</div>
                        </div>
                        <div class="bg-yellow-50 p-6 rounded-lg text-center">
                            <div class="text-3xl font-bold text-yellow-600">${employerApplications.filter(app => app.status === 'new').length}</div>
                            <div class="text-yellow-800 font-medium">New applications</div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div>
                            <h4 class="text-lg font-semibold text-gray-900 mb-4">My Job Offers</h4>
                            <div class="space-y-3 max-h-64 overflow-y-auto">
                                ${employerJobs.length > 0 ? employerJobs.slice(0, 5).map(job => `
                                    <div class="p-3 bg-gray-50 rounded-lg">
                                        <div class="font-medium">${job.title}</div>
                                        <div class="text-sm text-gray-600">${job.location} ‚Ä¢ ${job.type}</div>
                                        <div class="text-xs text-gray-500">${job.posted}</div>
                                    </div>
                                `).join('') : '<p class="text-gray-500 text-sm">No jobs published</p>'}
                            </div>
                        </div>
                        
                        <div>
                            <h4 class="text-lg font-semibold text-gray-900 mb-4">Recent Applications</h4>
                            <div class="space-y-3 max-h-64 overflow-y-auto">
                                ${employerApplications.length > 0 ? employerApplications.slice(0, 5).map(app => `
                                    <div class="p-3 bg-gray-50 rounded-lg">
                                        <div class="font-medium">${app.candidateName}</div>
                                        <div class="text-sm text-gray-600">${app.jobTitle}</div>
                                        <div class="text-xs text-gray-500">${app.date}</div>
                                    </div>
                                `).join('') : '<p class="text-gray-500 text-sm">No applications received</p>'}
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-8 pt-6 border-t">
                        <div class="flex justify-between items-center mb-4">
                            <h4 class="text-lg font-semibold text-gray-900">Account Information</h4>
                            <button onclick="showEditProfileModal()" class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition-colors text-sm">
                                ‚úèÔ∏è Edit Profile
                            </button>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                            <div>
                                <span class="text-gray-600">Account type:</span>
                                <span class="ml-2 font-medium">Employer</span>
                            </div>
                            <div>
                                <span class="text-gray-600">Member since:</span>
                                <span class="ml-2 font-medium">${new Date(currentUser.createdAt).toLocaleDateString('en-US')}</span>
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        // Function to determine which button to show for each job
        function getJobActionButton(job) {
            console.log('Checking button for job:', job.id, 'User logged in:', isLoggedIn, 'Current user:', currentUser);
            
            // If user is not logged in
            if (!isLoggedIn || !currentUser) {
                return `<button onclick="showLoginModal()" class="bg-indigo-600 text-white px-6 py-2 rounded-lg hover:bg-indigo-700 transition-colors">Login to apply</button>`;
            }
            
            // If user is an employer
            if (currentUser.accountType === 'employer') {
                // If it's their own job offer
                if (job.employerEmail === currentUser.email) {
                    return `
                        <button onclick="editJob(${job.id})" class="bg-yellow-600 text-white px-4 py-2 rounded-lg hover:bg-yellow-700 transition-colors text-sm">‚úèÔ∏è Edit</button>
                        <button onclick="deleteJob(${job.id})" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors text-sm">üóëÔ∏è Delete</button>
                    `;
                } else {
                    // Other employer's job - they can't apply or modify
                    return `<button class="bg-gray-400 text-white px-6 py-2 rounded-lg cursor-not-allowed" disabled>For candidates only</button>`;
                }
            }
            
            // If user is a candidate
            if (currentUser && currentUser.accountType === 'candidate') {
                return `<button onclick="applyToJob(${job.id})" class="bg-indigo-600 text-white px-6 py-2 rounded-lg hover:bg-indigo-700 transition-colors">Apply</button>`;
            }
            
            // Default fallback
            return `<button onclick="showLoginModal()" class="bg-indigo-600 text-white px-6 py-2 rounded-lg hover:bg-indigo-700 transition-colors">Login to apply</button>`;
        }

        // Job search and display functions
        function displayJobs(jobs) {
            const container = document.getElementById('jobs-container');
            container.innerHTML = '';
            
            console.log('Displaying jobs. Current user state:', { isLoggedIn, currentUser });
            
            jobs.forEach(job => {
                const jobCard = document.createElement('div');
                jobCard.className = 'bg-white rounded-xl shadow-md p-6 card-hover cursor-pointer';
                jobCard.innerHTML = `
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h3 class="text-xl font-semibold text-gray-900 mb-2">${job.title}</h3>
                            <p class="text-indigo-600 font-medium">${job.company}</p>
                        </div>
                        <span class="px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm">${job.type}</span>
                    </div>
                    <div class="flex items-center text-gray-600 mb-3">
                        <span class="mr-4">üìç ${job.location}</span>
                        <span class="mr-4">üí∞ ${job.salary}</span>
                        <span>üïí ${job.posted}</span>
                    </div>
                    <p class="text-gray-700 mb-4">${job.description}</p>
                    <div class="flex justify-between items-center">
                        <span class="px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm">${job.sector}</span>
                        <div class="flex space-x-2">
                            ${getJobActionButton(job)}
                        </div>
                    </div>
                `;
                container.appendChild(jobCard);
            });
        }

        function searchJobs() {
            const searchTerm = document.getElementById('job-search').value.toLowerCase();
            const location = document.getElementById('location-search').value.toLowerCase();
            
            const filteredJobs = allJobs.filter(job => {
                const matchesSearch = job.title.toLowerCase().includes(searchTerm) || 
                                    job.company.toLowerCase().includes(searchTerm) ||
                                    job.description.toLowerCase().includes(searchTerm);
                const matchesLocation = location === '' || job.location.toLowerCase().includes(location);
                return matchesSearch && matchesLocation;
            });
            
            displayJobs(filteredJobs);
            
            // Show jobs section
            showSection('jobs');
        }

        function applyToJob(jobId) {
            console.log('Apply button clicked for job ID:', jobId);
            
            // Check if user is logged in
            if (!isLoggedIn) {
                alert('You must be logged in to apply for a job');
                showLoginModal();
                return;
            }
            
            // Check if user is a candidate
            if (currentUser.accountType !== 'candidate') {
                alert('Only candidates can apply for job offers');
                return;
            }
            
            const job = allJobs.find(j => j.id === jobId);
            console.log('Found job:', job);
            
            if (job) {
                showApplicationModal(job.title, job.company, job.employerEmail);
            } else {
                alert('Error: Job offer not found');
            }
        }
        
        // Applications management
        let allApplications = [
            {
                id: 1,
                jobTitle: "Frontend React Developer",
                company: "TechCorp",
                candidateName: "Marie Dubois",
                email: "marie.dubois@email.com",
                phone: "06 12 34 56 78",
                linkedin: "https://linkedin.com/in/marie-dubois",
                coverLetter: "Passionate about frontend development, I have 3 years of experience in React...",
                salaryExpectation: "$48,000",
                availability: "2 weeks",
                date: "12/15/2024",
                status: "new",
                employerEmail: "recruitment@techcorp.com"
            },
            {
                id: 2,
                jobTitle: "Marketing Project Manager",
                company: "MarketPro",
                candidateName: "Pierre Martin",
                email: "pierre.martin@email.com",
                phone: "07 98 76 54 32",
                linkedin: "https://linkedin.com/in/pierre-martin",
                coverLetter: "With 5 years of experience in digital marketing, I want to join your team...",
                salaryExpectation: "$45,000",
                availability: "1 month",
                date: "12/14/2024",
                status: "reviewed",
                employerEmail: "hr@marketpro.com"
            }
        ];
        
        function displayApplications() {
            const container = document.getElementById('applications-container');
            container.innerHTML = '';
            
            // Filter applications for current employer only
            const employerApplications = allApplications.filter(app => 
                app.employerEmail === currentUser.email
            );
            
            if (employerApplications.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-12">
                        <div class="text-6xl mb-4">üìã</div>
                        <h3 class="text-xl font-semibold text-gray-900 mb-2">No applications received</h3>
                        <p class="text-gray-600">Applications for your job offers will appear here once candidates apply.</p>
                        <p class="text-gray-500 text-sm mt-2">Employer email: ${currentUser.email}</p>
                    </div>
                `;
                return;
            }
            
            employerApplications.forEach(application => {
                const statusColors = {
                    'new': 'bg-blue-100 text-blue-800',
                    'reviewed': 'bg-yellow-100 text-yellow-800',
                    'contacted': 'bg-green-100 text-green-800'
                };
                
                const statusLabels = {
                    'new': 'New',
                    'reviewed': 'Reviewed',
                    'contacted': 'Contacted'
                };
                
                const applicationCard = document.createElement('div');
                applicationCard.className = 'border border-gray-200 rounded-lg p-6 hover:shadow-md transition-shadow';
                applicationCard.innerHTML = `
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h4 class="text-lg font-semibold text-gray-900">${application.candidateName}</h4>
                            <p class="text-indigo-600 font-medium">${application.jobTitle} - ${application.company}</p>
                            <p class="text-gray-500 text-sm">Application received on ${application.date}</p>
                        </div>
                        <span class="px-3 py-1 rounded-full text-sm ${statusColors[application.status]}">${statusLabels[application.status]}</span>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <p class="text-sm text-gray-600"><strong>Email:</strong> ${application.email}</p>
                            <p class="text-sm text-gray-600"><strong>Phone:</strong> ${application.phone}</p>
                            ${application.linkedin ? `<p class="text-sm text-gray-600"><strong>LinkedIn:</strong> <a href="${application.linkedin}" target="_blank" class="text-indigo-600 hover:underline">View profile</a></p>` : ''}
                        </div>
                        <div>
                            <p class="text-sm text-gray-600"><strong>Salary expectations:</strong> ${application.salaryExpectation || 'Not specified'}</p>
                            <p class="text-sm text-gray-600"><strong>Availability:</strong> ${application.availability}</p>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <p class="text-sm font-medium text-gray-700 mb-2">Cover letter:</p>
                        <p class="text-sm text-gray-600 bg-gray-50 p-3 rounded-lg">${application.coverLetter.substring(0, 200)}${application.coverLetter.length > 200 ? '...' : ''}</p>
                    </div>
                    
                    <div class="flex flex-wrap gap-2">
                        <button onclick="contactCandidate('${application.email}', '${application.candidateName}', '${application.jobTitle}')" class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition-colors text-sm">Contact</button>
                        <button onclick="downloadCV('${application.candidateName}')" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors text-sm">üìÑ Download CV</button>
                        <button onclick="updateApplicationStatus(${application.id}, 'reviewed')" class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors text-sm">Mark as reviewed</button>
                        <button onclick="viewFullApplication(${application.id})" class="border border-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-50 transition-colors text-sm">View details</button>
                        <button onclick="deleteApplication(${application.id})" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors text-sm">üóëÔ∏è Delete</button>
                    </div>
                `;
                container.appendChild(applicationCard);
            });
        }
        
        function contactCandidate(email, name, jobTitle) {
            const subject = encodeURIComponent(`Application for ${jobTitle} position`);
            const body = encodeURIComponent(`Hello ${name},\n\nWe have received your application for the ${jobTitle} position.\n\nWe would like to meet with you to discuss your profile.\n\nCan you confirm your availability for an interview?\n\nBest regards,\nHR Team`);
            
            window.open(`mailto:${email}?subject=${subject}&body=${body}`);
            
            // Update status to contacted
            const application = allApplications.find(app => app.email === email);
            if (application) {
                updateApplicationStatus(application.id, 'contacted');
            }
        }
        
        function updateApplicationStatus(applicationId, newStatus) {
            const application = allApplications.find(app => app.id === applicationId);
            if (application) {
                application.status = newStatus;
                // Save updated status to localStorage
                localStorage.setItem('allApplications', JSON.stringify(allApplications));
                displayApplications();
            }
        }
        
        function editJob(jobId) {
            const job = allJobs.find(j => j.id === jobId);
            if (!job) {
                alert('Error: Job not found');
                return;
            }
            
            // Check if user is the owner of this job
            if (!currentUser || currentUser.accountType !== 'employer' || job.employerEmail !== currentUser.email) {
                alert('You can only edit your own job offers');
                return;
            }
            
            // Switch to post-job section and pre-fill the form
            showSection('post-job');
            
            // Pre-fill the form with existing job data
            setTimeout(() => {
                document.getElementById('job-title').value = job.title;
                document.getElementById('company-name').value = job.company;
                document.getElementById('job-location').value = job.location;
                document.getElementById('job-sector').value = job.sector;
                document.getElementById('job-type').value = job.type;
                document.getElementById('job-salary').value = job.salary === 'Negotiable' ? '' : job.salary;
                document.getElementById('job-description').value = job.description;
                document.getElementById('employer-email').value = job.employerEmail;
                
                // Change form title and button text
                const formTitle = document.querySelector('#post-job-section h2');
                if (formTitle) {
                    formTitle.textContent = 'Edit Job Offer';
                }
                
                const submitButton = document.querySelector('#job-form button[type="submit"]');
                if (submitButton) {
                    submitButton.textContent = 'Update Job';
                    submitButton.setAttribute('data-editing', jobId);
                }
            }, 100);
        }

        function deleteJob(jobId) {
            const job = allJobs.find(j => j.id === jobId);
            if (!job) {
                alert('Error: Job not found');
                return;
            }
            
            // Check if user is the owner of this job
            if (!currentUser || currentUser.accountType !== 'employer' || job.employerEmail !== currentUser.email) {
                alert('You can only delete your own job offers');
                return;
            }
            
            // Confirm deletion
            const confirmDelete = confirm(`Are you sure you want to delete this job offer?\n\n"${job.title}" at ${job.company}\n\nThis action is irreversible. All associated applications will also be deleted.`);
            
            if (confirmDelete) {
                // Remove job from array
                const jobIndex = allJobs.findIndex(j => j.id === jobId);
                if (jobIndex > -1) {
                    allJobs.splice(jobIndex, 1);
                    
                    // Remove associated applications
                    const applicationsToRemove = allApplications.filter(app => 
                        app.jobTitle === job.title && app.company === job.company && app.employerEmail === job.employerEmail
                    );
                    
                    applicationsToRemove.forEach(app => {
                        const appIndex = allApplications.findIndex(a => a.id === app.id);
                        if (appIndex > -1) {
                            allApplications.splice(appIndex, 1);
                        }
                    });
                    
                    // Save to localStorage
                    localStorage.setItem('allJobs', JSON.stringify(allJobs));
                    localStorage.setItem('allApplications', JSON.stringify(allApplications));
                    
                    // Refresh display
                    displayJobs(allJobs);
                    
                    alert(`‚úÖ Job deleted successfully!\n\n"${job.title}" at ${job.company} has been deleted.\n${applicationsToRemove.length} associated application(s) have also been deleted.`);
                }
            }
        }
        
        function deleteApplication(applicationId) {
            const application = allApplications.find(app => app.id === applicationId);
            if (!application) {
                alert('Error: Application not found');
                return;
            }
            
            // Check if user is the employer who received this application
            if (!currentUser || currentUser.accountType !== 'employer' || application.employerEmail !== currentUser.email) {
                alert('You can only delete applications received for your job offers');
                return;
            }
            
            // Confirm deletion
            const confirmDelete = confirm(`Are you sure you want to delete this application?\n\nCandidate: ${application.candidateName}\nPosition: ${application.jobTitle}\nDate: ${application.date}\n\nThis action is irreversible.`);
            
            if (confirmDelete) {
                // Remove application from array
                const appIndex = allApplications.findIndex(app => app.id === applicationId);
                if (appIndex > -1) {
                    allApplications.splice(appIndex, 1);
                    
                    // Save to localStorage
                    localStorage.setItem('allApplications', JSON.stringify(allApplications));
                    
                    // Refresh display
                    displayApplications();
                    
                    alert(`‚úÖ Application deleted successfully!\n\n${application.candidateName}'s application for "${application.jobTitle}" has been deleted.`);
                }
            }
        }
        
        function viewFullApplication(applicationId) {
            const application = allApplications.find(app => app.id === applicationId);
            if (application) {
                alert(`Full application:\n\nName: ${application.candidateName}\nEmail: ${application.email}\nPhone: ${application.phone}\nLinkedIn: ${application.linkedin || 'Not provided'}\n\nCover letter:\n${application.coverLetter}\n\nSalary expectations: ${application.salaryExpectation || 'Not specified'}\nAvailability: ${application.availability}`);
            }
        }
        
        function downloadCV(candidateName) {
            // Simulate CV download - in a real app, this would download the actual file
            const cvContent = `CV - ${candidateName}
            
                PERSONAL INFORMATION
                   Name: ${candidateName}
                   Email: ${candidateName.toLowerCase().replace(' ', '.')}@email.com
                   Phone: 06 12 34 56 78

                WORK EXPERIENCE
                   2021-2024 : Full Stack Developer - TechCorp
                   - Web application development with React and Node.js
                   - Collaboration with design and product teams
                   - Performance maintenance and optimization

                   2019-2021 : Frontend Developer - StartupInnovante
                   - Modern user interface creation
                   - REST API integration
                   - Unit and functional testing

                EDUCATION
                  2019 : Master's in Computer Science - University of Paris
                  2017 : Bachelor's in Computer Science - University of Lyon

                TECHNICAL SKILLS
                  - Languages: JavaScript, Python, Java
                  - Frameworks: React, Vue.js, Node.js
                  - Databases: MySQL, MongoDB
                  - Tools: Git, Docker, AWS

                LANGUAGES
                  - French: Native
                  - English: Fluent
                  - Spanish: Intermediate

                INTERESTS
                  - Open source development
                  - Technology watch
                  - Sports and travel`;

            // Create and download the CV file
            const blob = new Blob([cvContent], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `CV_${candidateName.replace(' ', '_')}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            
            alert(`üìÑ ${candidateName}'s CV downloaded successfully!\n\nThe file has been saved to your downloads.`);
        }
        
        function showApplicationModal(jobTitle, company, employerEmail) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                    <div class="p-6 border-b">
                        <div class="flex justify-between items-center">
                            <h3 class="text-2xl font-bold text-gray-900">Apply for ${jobTitle}</h3>
                            <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
                        </div>
                        <p class="text-gray-600 mt-2">At ${company}</p>
                    </div>
                    
                    <form id="application-form" class="p-6 space-y-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">First Name *</label>
                                <input type="text" id="first-name" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Last Name *</label>
                                <input type="text" id="last-name" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" required>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Email *</label>
                                <input type="email" id="email" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Phone *</label>
                                <input type="tel" id="phone" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" required>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">LinkedIn (optional)</label>
                            <input type="url" id="linkedin" placeholder="https://linkedin.com/in/your-profile" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">CV (PDF) *</label>
                            <input type="file" id="cv-file" accept=".pdf,.doc,.docx" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" required>
                            <p class="text-sm text-gray-500 mt-1">Accepted formats: PDF, DOC, DOCX (max 5MB)</p>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Cover Letter *</label>
                            <textarea id="cover-letter" rows="6" placeholder="Explain why you are the ideal candidate for this position..." class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" required></textarea>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Salary Expectations (optional)</label>
                            <input type="text" id="salary-expectation" placeholder="e.g. $45,000 annual" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Availability</label>
                            <select id="availability" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" required>
                                <option value="">Select</option>
                                <option value="immediate">Immediate</option>
                                <option value="2weeks">2 weeks</option>
                                <option value="1month">1 month</option>
                                <option value="2months">2 months</option>
                                <option value="3months">3 months or more</option>
                            </select>
                        </div>
                        
                        <div class="flex items-start">
                            <input type="checkbox" id="consent" class="mt-1 mr-3" required>
                            <label for="consent" class="text-sm text-gray-700">
                                I agree that my personal data may be processed as part of my application and that the employer may contact me by email or phone. *
                            </label>
                        </div>
                        
                        <div class="flex space-x-4 pt-4">
                            <button type="button" onclick="closeModal()" class="flex-1 px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">Cancel</button>
                            <button type="submit" class="flex-1 px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors">Send my application</button>
                        </div>
                    </form>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Handle form submission
            document.getElementById('application-form').addEventListener('submit', function(e) {
                e.preventDefault();
                submitApplication(jobTitle, company);
            });
        }
        
        function closeModal() {
            const modal = document.querySelector('.fixed.inset-0');
            if (modal) {
                modal.remove();
            }
        }
        
        function submitApplication(jobTitle, company) {
            const job = allJobs.find(j => j.title === jobTitle && j.company === company);
            const employerEmail = job ? job.employerEmail : 'employer@company.com';
            
            const formData = {
                firstName: document.getElementById('first-name').value,
                lastName: document.getElementById('last-name').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value,
                linkedin: document.getElementById('linkedin').value,
                coverLetter: document.getElementById('cover-letter').value,
                salaryExpectation: document.getElementById('salary-expectation').value,
                availability: document.getElementById('availability').value,
                cvFile: document.getElementById('cv-file').files[0]
            };
            
            // Add to applications database
            const newApplication = {
                id: Date.now(), // Use timestamp for unique ID
                jobTitle: jobTitle,
                company: company,
                candidateName: `${formData.firstName} ${formData.lastName}`,
                email: formData.email,
                phone: formData.phone,
                linkedin: formData.linkedin,
                coverLetter: formData.coverLetter,
                salaryExpectation: formData.salaryExpectation,
                availability: formData.availability,
                date: new Date().toLocaleDateString('en-US'),
                dateTime: new Date().toISOString(),
                status: 'new',
                employerEmail: employerEmail
            };
            
            allApplications.unshift(newApplication);
            
            // SAVE TO LOCALSTORAGE - PERMANENT STORAGE
            localStorage.setItem('allApplications', JSON.stringify(allApplications));
            
            // Simulate sending application
            const applicationDate = new Date().toLocaleDateString('en-US');
            
            // Close modal
            closeModal();
            
            // Show success message with contact info
            alert(`‚úÖ Application sent successfully!\n\nPosition: ${jobTitle}\nCompany: ${company}\nCandidate: ${formData.firstName} ${formData.lastName}\nEmail: ${formData.email}\nPhone: ${formData.phone}\nDate: ${applicationDate}\n\nüìß Your application has been sent to: ${employerEmail}\n\nThe employer will receive your CV, cover letter and all your contact information. They can contact you directly by email or phone.\n\nYou can see your application status in the employer's "Applications" section.`);
            
            // Update profile section with new application
            updateUserApplications(jobTitle, company, formData);
        }
        
        function updateUserApplications(jobTitle, company, formData) {
            // This would normally save to a database, here we simulate it
            console.log(`New application added: ${jobTitle} at ${company}`, formData);
            
            // Add to user's application history (in real app, this would be saved to database)
            const applicationHistory = JSON.parse(localStorage.getItem('userApplications') || '[]');
            applicationHistory.unshift({
                jobTitle,
                company,
                candidateName: `${formData.firstName} ${formData.lastName}`,
                email: formData.email,
                phone: formData.phone,
                date: new Date().toLocaleDateString('en-US'),
                status: 'Sent'
            });
            localStorage.setItem('userApplications', JSON.stringify(applicationHistory));
        }

        // Job filter
        document.getElementById('job-filter').addEventListener('change', function() {
            const sector = this.value;
            const filteredJobs = sector === '' ? allJobs : allJobs.filter(job => job.sector === sector);
            displayJobs(filteredJobs);
        });

        // Job posting form
        document.getElementById('job-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const submitButton = this.querySelector('button[type="submit"]');
            const editingJobId = submitButton.getAttribute('data-editing');
            
            if (editingJobId) {
                // Update existing job
                const jobIndex = allJobs.findIndex(j => j.id == editingJobId);
                if (jobIndex > -1) {
                    allJobs[jobIndex] = {
                        ...allJobs[jobIndex], // Keep original id and dateCreated
                        title: document.getElementById('job-title').value,
                        company: document.getElementById('company-name').value,
                        location: document.getElementById('job-location').value,
                        sector: document.getElementById('job-sector').value,
                        type: document.getElementById('job-type').value,
                        salary: document.getElementById('job-salary').value || 'Negotiable',
                        description: document.getElementById('job-description').value,
                        posted: "Modified now",
                        lastModified: new Date().toISOString(),
                        employerEmail: currentUser.email
                    };
                    
                    // SAVE TO LOCALSTORAGE
                    localStorage.setItem('allJobs', JSON.stringify(allJobs));
                    
                    alert('‚úÖ Job offer updated successfully!');
                    
                    // Reset form and button
                    this.reset();
                    submitButton.textContent = 'Publish Job';
                    submitButton.removeAttribute('data-editing');
                    
                    // Reset form title
                    const formTitle = document.querySelector('#post-job-section h2');
                    if (formTitle) {
                        formTitle.textContent = 'Post a Job Offer';
                    }
                    
                    // Show jobs section
                    showSection('jobs');
                    displayJobs(allJobs);
                }
            } else {
                // Create new job
                const newJob = {
                    id: Date.now(), // Use timestamp for unique ID
                    title: document.getElementById('job-title').value,
                    company: document.getElementById('company-name').value,
                    location: document.getElementById('job-location').value,
                    sector: document.getElementById('job-sector').value,
                    type: document.getElementById('job-type').value,
                    salary: document.getElementById('job-salary').value || 'Negotiable',
                    description: document.getElementById('job-description').value,
                    posted: "Now",
                    dateCreated: new Date().toISOString(),
                    employerEmail: currentUser.email // Use logged-in employer's email
                };
                
                allJobs.unshift(newJob);
                
                // SAVE TO LOCALSTORAGE - PERMANENT STORAGE
                localStorage.setItem('allJobs', JSON.stringify(allJobs));
                
                alert('‚úÖ Job offer published successfully!');
                
                // Reset form
                this.reset();
                
                // Show jobs section
                showSection('jobs');
                displayJobs(allJobs);
            }
        });

        // Photo management functions
        function showPhotoModal() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-white rounded-xl shadow-2xl max-w-md w-full">
                    <div class="p-6 border-b">
                        <div class="flex justify-between items-center">
                            <h3 class="text-2xl font-bold text-gray-900">Profile Photo</h3>
                            <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
                        </div>
                    </div>
                    
                    <div class="p-6">
                        <div class="text-center mb-6">
                            <div class="w-32 h-32 mx-auto rounded-full overflow-hidden bg-indigo-100 flex items-center justify-center mb-4">
                                ${currentUser.profilePhoto ? 
                                    `<img src="${currentUser.profilePhoto}" alt="Current photo" class="w-full h-full object-cover">` :
                                    `<span class="text-4xl font-bold text-indigo-600">${currentUser.firstName.charAt(0)}${currentUser.lastName.charAt(0)}</span>`
                                }
                            </div>
                            <p class="text-gray-600 text-sm">Current photo</p>
                        </div>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Choose a new photo</label>
                                <input type="file" id="profile-photo-input" accept="image/*" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                                <p class="text-sm text-gray-500 mt-1">Accepted formats: JPG, PNG, GIF (max 2MB)</p>
                            </div>
                            
                            <div class="flex space-x-3">
                                <button onclick="uploadProfilePhoto()" class="flex-1 bg-indigo-600 text-white px-4 py-3 rounded-lg hover:bg-indigo-700 transition-colors">
                                    üì∑ Update
                                </button>
                                ${currentUser.profilePhoto ? 
                                    `<button onclick="removeProfilePhoto()" class="flex-1 bg-red-600 text-white px-4 py-3 rounded-lg hover:bg-red-700 transition-colors">
                                        üóëÔ∏è Remove
                                    </button>` : ''
                                }
                            </div>
                            
                            <button onclick="closeModal()" class="w-full border border-gray-300 text-gray-700 px-4 py-3 rounded-lg hover:bg-gray-50 transition-colors">
                                Cancel
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
        
        function uploadProfilePhoto() {
            const fileInput = document.getElementById('profile-photo-input');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('Please select a photo');
                return;
            }
            
            // Validate file type
            if (!file.type.startsWith('image/')) {
                alert('Please select a valid image file (JPG, PNG, GIF)');
                return;
            }
            
            // Validate file size (2MB max)
            if (file.size > 2 * 1024 * 1024) {
                alert('File size must not exceed 2MB');
                return;
            }
            
            // Convert to base64 for storage
            const reader = new FileReader();
            reader.onload = function(e) {
                const base64Image = e.target.result;
                
                // Update current user
                currentUser.profilePhoto = base64Image;
                
                // Update in users array
                const users = JSON.parse(localStorage.getItem('users') || '[]');
                const userIndex = users.findIndex(u => u.id === currentUser.id);
                if (userIndex > -1) {
                    users[userIndex].profilePhoto = base64Image;
                    localStorage.setItem('users', JSON.stringify(users));
                }
                
                // Update current user in localStorage
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                
                // Close modal and refresh profile
                closeModal();
                displayUserProfile();
                
                alert('‚úÖ Profile photo updated successfully!');
            };
            
            reader.onerror = function() {
                alert('Error loading image. Please try again.');
            };
            
            reader.readAsDataURL(file);
        }
        
        function removeProfilePhoto() {
            const confirmDelete = confirm('Are you sure you want to remove your profile photo?');
            
            if (confirmDelete) {
                // Remove from current user
                delete currentUser.profilePhoto;
                
                // Update in users array
                const users = JSON.parse(localStorage.getItem('users') || '[]');
                const userIndex = users.findIndex(u => u.id === currentUser.id);
                if (userIndex > -1) {
                    delete users[userIndex].profilePhoto;
                    localStorage.setItem('users', JSON.stringify(users));
                }
                
                // Update current user in localStorage
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                
                // Close modal and refresh profile
                closeModal();
                displayUserProfile();
                
                alert('‚úÖ Profile photo removed successfully!');
            }
        }

        function showEditProfileModal() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            
            const isCandidate = currentUser.accountType === 'candidate';
            
            modal.innerHTML = `
                <div class="bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                    <div class="p-6 border-b">
                        <div class="flex justify-between items-center">
                            <h3 class="text-2xl font-bold text-gray-900">Edit Profile</h3>
                            <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
                        </div>
                    </div>
                    
                    <form id="edit-profile-form" class="p-6 space-y-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">First Name *</label>
                                <input type="text" id="edit-firstname" value="${currentUser.firstName}" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Last Name *</label>
                                <input type="text" id="edit-lastname" value="${currentUser.lastName}" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" required>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Email *</label>
                            <input type="email" id="edit-email" value="${currentUser.email}" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" required>
                            <p class="text-sm text-gray-500 mt-1">Changing your email will require re-verification</p>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Country of residence *</label>
                            <select id="edit-country" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" required>
                                <option value="">Select your country</option>
                                <option value="US" ${currentUser.country === 'US' ? 'selected' : ''}>United States</option>
                                <option value="CA" ${currentUser.country === 'CA' ? 'selected' : ''}>Canada</option>
                                <option value="GB" ${currentUser.country === 'GB' ? 'selected' : ''}>United Kingdom</option>
                                <option value="FR" ${currentUser.country === 'FR' ? 'selected' : ''}>France</option>
                                <option value="DE" ${currentUser.country === 'DE' ? 'selected' : ''}>Germany</option>
                                <option value="ES" ${currentUser.country === 'ES' ? 'selected' : ''}>Spain</option>
                                <option value="IT" ${currentUser.country === 'IT' ? 'selected' : ''}>Italy</option>
                                <option value="NL" ${currentUser.country === 'NL' ? 'selected' : ''}>Netherlands</option>
                                <option value="BE" ${currentUser.country === 'BE' ? 'selected' : ''}>Belgium</option>
                                <option value="CH" ${currentUser.country === 'CH' ? 'selected' : ''}>Switzerland</option>
                                <option value="AU" ${currentUser.country === 'AU' ? 'selected' : ''}>Australia</option>
                                <option value="NZ" ${currentUser.country === 'NZ' ? 'selected' : ''}>New Zealand</option>
                                <option value="OTHER" ${currentUser.country === 'OTHER' ? 'selected' : ''}>üåç Other country</option>
                            </select>
                        </div>
                        
                        ${isCandidate ? `
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">About yourself</label>
                                <textarea id="edit-bio" rows="4" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">${currentUser.bio || ''}</textarea>
                                <p class="text-sm text-gray-500 mt-1">Describe your background, career goals, and what motivates you</p>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Your skills</label>
                                <input type="text" id="edit-skills" value="${(currentUser.skills || []).join(', ')}" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                                <p class="text-sm text-gray-500 mt-1">Separate your skills with commas (e.g., JavaScript, React, Communication)</p>
                            </div>
                        ` : `
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Company Name *</label>
                                <input type="text" id="edit-company" value="${currentUser.company || ''}" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" required>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">About your company</label>
                                <textarea id="edit-company-bio" rows="4" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">${currentUser.bio || ''}</textarea>
                                <p class="text-sm text-gray-500 mt-1">Describe your company, industry, values, and company culture</p>
                            </div>
                        `}
                        
                        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                            <h4 class="font-medium text-yellow-800 mb-2">üîí Change Password</h4>
                            <div class="space-y-3">
                                <div>
                                    <label class="block text-sm font-medium text-yellow-700 mb-1">Current Password</label>
                                    <input type="password" id="edit-current-password" class="w-full px-3 py-2 border border-yellow-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-yellow-700 mb-1">New Password</label>
                                    <input type="password" id="edit-new-password" class="w-full px-3 py-2 border border-yellow-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-yellow-700 mb-1">Confirm New Password</label>
                                    <input type="password" id="edit-confirm-password" class="w-full px-3 py-2 border border-yellow-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent">
                                </div>
                                <p class="text-sm text-yellow-600">Leave blank if you don't want to change your password</p>
                            </div>
                        </div>
                        
                        <div class="flex space-x-4 pt-4">
                            <button type="button" onclick="closeModal()" class="flex-1 px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">Cancel</button>
                            <button type="submit" class="flex-1 px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors">Save Changes</button>
                        </div>
                    </form>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            document.getElementById('edit-profile-form').addEventListener('submit', function(e) {
                e.preventDefault();
                handleProfileUpdate();
            });
        }

        function handleProfileUpdate() {
            const firstName = document.getElementById('edit-firstname').value;
            const lastName = document.getElementById('edit-lastname').value;
            const email = document.getElementById('edit-email').value;
            const country = document.getElementById('edit-country').value;
            const currentPassword = document.getElementById('edit-current-password').value;
            const newPassword = document.getElementById('edit-new-password').value;
            const confirmPassword = document.getElementById('edit-confirm-password').value;
            
            // Basic validation
            if (!firstName || !lastName || !email || !country) {
                alert('Please fill in all required fields');
                return;
            }
            
            // Email validation
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                alert('Please enter a valid email address');
                return;
            }
            
            // Password change validation
            if (currentPassword || newPassword || confirmPassword) {
                if (!currentPassword) {
                    alert('Please enter your current password to change it');
                    return;
                }
                
                if (currentPassword !== currentUser.password) {
                    alert('Current password is incorrect');
                    return;
                }
                
                if (!newPassword || newPassword.length < 6) {
                    alert('New password must be at least 6 characters long');
                    return;
                }
                
                if (newPassword !== confirmPassword) {
                    alert('New passwords do not match');
                    return;
                }
            }
            
            // Check if email is already used by another user
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const existingUser = users.find(u => u.email === email && u.id !== currentUser.id);
            if (existingUser) {
                alert('This email address is already used by another account');
                return;
            }
            
            // Get country name from code
            const countryNames = {
                'US': 'United States', 'CA': 'Canada', 'GB': 'United Kingdom', 'FR': 'France',
                'DE': 'Germany', 'ES': 'Spain', 'IT': 'Italy', 'NL': 'Netherlands',
                'BE': 'Belgium', 'CH': 'Switzerland', 'AU': 'Australia', 'NZ': 'New Zealand',
                'OTHER': 'Other country'
            };
            
            // Update user data
            const updatedUser = {
                ...currentUser,
                firstName,
                lastName,
                email,
                country,
                countryName: countryNames[country] || country,
                location: countryNames[country] || country
            };
            
            // Update password if provided
            if (newPassword) {
                updatedUser.password = newPassword;
            }
            
            // Update specific fields based on account type
            if (currentUser.accountType === 'candidate') {
                const bio = document.getElementById('edit-bio').value;
                const skillsInput = document.getElementById('edit-skills').value;
                const skills = skillsInput ? skillsInput.split(',').map(skill => skill.trim()).filter(skill => skill.length > 0) : [];
                
                updatedUser.bio = bio || `Motivated professional with strong adaptability and excellent teamwork skills. Always looking for new challenges and opportunities for professional growth.`;
                updatedUser.skills = skills.length > 0 ? skills : ['Communication', 'Teamwork', 'Adaptability', 'Problem Solving'];
            } else {
                const company = document.getElementById('edit-company').value;
                const companyBio = document.getElementById('edit-company-bio').value;
                
                if (!company) {
                    alert('Company name is required for employers');
                    return;
                }
                
                updatedUser.company = company;
                updatedUser.bio = companyBio || `Dynamic and innovative company, we are looking for the best talent to join our team and contribute to our growth.`;
            }
            
            // Update in users array
            const userIndex = users.findIndex(u => u.id === currentUser.id);
            if (userIndex > -1) {
                users[userIndex] = updatedUser;
                localStorage.setItem('users', JSON.stringify(users));
            }
            
            // Update current user
            currentUser = updatedUser;
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            
            // Update UI
            document.getElementById('user-welcome').textContent = `Hello ${currentUser.firstName}`;
            
            // Close modal and refresh profile
            closeModal();
            displayUserProfile();
            
            // Show success message
            let successMessage = `‚úÖ Profile updated successfully!\n\n`;
            successMessage += `‚Ä¢ Name: ${firstName} ${lastName}\n`;
            successMessage += `‚Ä¢ Email: ${email}\n`;
            successMessage += `‚Ä¢ Country: ${countryNames[country]}\n`;
            
            if (currentUser.accountType === 'candidate') {
                const skills = updatedUser.skills || [];
                successMessage += `‚Ä¢ Skills: ${skills.length} skill(s) updated\n`;
            } else {
                successMessage += `‚Ä¢ Company: ${updatedUser.company}\n`;
            }
            
            if (newPassword) {
                successMessage += `‚Ä¢ Password: Updated\n`;
            }
            
            successMessage += `\nAll changes have been saved to your profile.`;
            
            alert(successMessage);
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            // Load saved data from localStorage
            const savedJobs = localStorage.getItem('allJobs');
            if (savedJobs) {
                allJobs = JSON.parse(savedJobs);
            }
            
            const savedApplications = localStorage.getItem('allApplications');
            if (savedApplications) {
                allApplications = JSON.parse(savedApplications);
            }
            
            checkAuthOnLoad();
            displayJobs(allJobs);
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'964ec975a7460724',t:'MTc1MzQ3OTMyNS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>

